$(function(){var insid=$('#insid').val();var currentpage=1;var pagesize=6;var institutionid=1;var pageinfo=JSON.stringify({"currentpage":currentpage,"pagesize":pagesize,"institutionid":insid});var token=localStorage.getItem("Authorization");if(null!=token){$('#bottomlogin').hide()}else{$('#loga').html("登陆");$('#loga').attr("href","#bottomlogin")}insForumPageInfo(insid,1,6);getUserInfo();$.ajax({type:'post',url:'../forum/institutionForumList',contentType:'application/json;charset=utf-8',data:pageinfo,dataType:'json',success:function(data){if(null!=token){for(var i=0;i<data.length;i++){$('#forumContent').append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'><div style='margin: 1cm;'><a href='../p/"+data[i].forumid+"' target='_blank' ><h3 class='blog-post-title'>"+data[i].title+"</h3></a><hr><p class='blog-post-meta'>"+data[i].createtime+" by    @<a href='../user/otherUser?uid="+data[i].authorid+"&info="+token+"'>"+data[i].authorname+"</a></p><li><a href='../p/"+data[i].forumid+"'>"+data[i].title+"</a></li><p>"+data[i].description+"</p></div></div>")}}else{for(var i=0;i<data.length;i++){$('#forumContent').append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'><div style='margin: 1cm;'><a href='../p/"+data[i].forumid+"' target='_blank' ><h3 class='blog-post-title'>"+data[i].title+"</h3></a><hr><p class='blog-post-meta'>"+data[i].createtime+" by    @<a data-toggle='modal' data-target='#shouldloginmodal'>"+data[i].authorname+"</a></p><li><a href='../p/"+data[i].forumid+"'>"+data[i].title+"</a></li><p>"+data[i].description+"</p></div></div>")}}institutionInfoList()}})});function institutionInfoList(){var currentpage=1;var pagesize=6;var pageinfo=JSON.stringify({"currentpage":currentpage,"pagesize":pagesize});$.ajax({type:'post',url:'../base/institutionInfoList',contentType:'application/json;charset=utf-8',data:pageinfo,dataType:'json',success:function(data){var count=0;for(var i=0;i<data.length;i++){$('#institutionOl').append("<li> <div class='col-md-55'> <div class='thumbnail'> <div class='image view view-first'><img style='width: 100%; display: block;' src='../img/"+data[i].image+"' alt='image' />  <div class='mask'> <p>"+data[i].description+"</p>   </div> </div> <div class='caption'> <p style='text-center'><a href='../ins/"+data[i].institutionid+"' >"+data[i].institutionname+"</a></p> </div> </div> </div> </li>");if(i%3===0&&i<data.length){count=count+1;$('#ul'+count).append("<li role='presentation' class=''><a href='../ins/"+data[i].institutionid+"'>"+data[i].institutionname+"</a></li>")}else{$('#ul'+count).append("<li role='presentation' class=''><a href='../ins/"+data[i].institutionid+"'>"+data[i].institutionname+"</a></li>")}}}})};function insForumPageInfo(insid,currentpage,pagesize){if(currentpage<1||pagesize<1||null==insid){var currentpage=1;var pagesize=6;var institutionid=1}else{var currentpage=currentpage;var pagesize=pagesize;var institutionid=insid}$.ajax({type:'post',url:'../base/insForumPageInfo',data:{"currentpage":currentpage,"pagesize":pagesize,"institutionid":institutionid},dataType:'json',success:function(pageinfo){for(var i=1;i<=pageinfo.totalpage;i++){if(i===1){$('#pageul').append(" <li><a href='javascript:void(0)' onclick='changepage("+pageinfo.currentpage+")'>Previous</a></li>")}$('#pageul').append(" <li class='active'><a href='javascript:void(0)' onclick='changepage("+i+")'>"+i+"</a></li>");if(i===pageinfo.totalpage){$('#pageul').append(" <li class='active'><a href='javascript:void(0)' onclick='changepage("+i+")'>Next</a></li>")}}}})};function insPageForum(currentpage){if(currentpage===null||currentpage<1)currentpage=1};function changepage(page){if(page<1){}else{var inid=$('#insid').val();var pagesize=6;var data={"institutionid":inid,"currentpage":page,"pagesize":pagesize};var token=localStorage.getItem("Authorization");$.ajax({type:'post',url:'../forum/institutionForumList',data:JSON.stringify(data),contentType:'application/json;charset=utf-8',dataType:'json',success:function(list){$('#forumContent').empty();if(null===token){for(var i=0;i<list.length;i++){$('#forumContent').append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'><div style='margin: 1cm;'><a href='../p/"+list[i].forumid+"' target='_blank' ><h3 class='blog-post-title'>"+list[i].title+"</h3></a><hr><p class='blog-post-meta'>"+list[i].createtime+" by    @<a data-toggle='modal' data-target='#shouldloginmodal'>"+list[i].authorname+"</a></p><li><a href='../p/"+list[i].forumid+"'>"+list[i].title+"</a></li><p>"+list[i].description+"</p></div></div>")}}else{for(var i=0;i<list.length;i++){$('#forumContent').append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'><div style='margin: 1cm;'><a href='../p/"+list[i].forumid+"' target='_blank' ><h3 class='blog-post-title'>"+list[i].title+"</h3></a><hr><p class='blog-post-meta'>"+list[i].createtime+" by    @<a href='../user/otherUser?uid="+list[i].authorid+"&info="+token+"'>"+list[i].authorname+"</a></p><li><a href='../p/"+list[i].forumid+"'>"+list[i].title+"</a></li><p>"+list[i].description+"</p></div></div>")}}}})}};function releaseforum(){var title=$('#title').val();var description=$('#editor-one').html();var jsonD={"title":title,"description":description,"institution_id":$('#insid').val(),};var jsonDD=JSON.stringify(jsonD);var token=localStorage.getItem("Authorization");if(null===token){$('#releaseForumInfo').modal("show");$('#myModalLabel').html("请求未发送");$('#gotoforum').html("去登陆");$('#releaseForumResult').html("验证信息失败,请登陆后重试");$('#gotoforum').attr("href","../html/login.html")}else if(null===title||title==""||title===undefined){$('#releaseForumInfo').modal("show");$('#myModalLabel').html("请求未发送");$('#gotoforum').html("为夫知道了");$('#releaseForumResult').html("发送信息不能为空");$('#gotoforum').attr("onclick","weifuzhidaole()")}else{$.ajax({type:"post",url:"../jwt/releaseForum",contentType:"application/json;charset=utf-8",dataType:'json',data:jsonDD,headers:{Authorization:token},success:function(data){$('#releaseForumInfo').modal('show');$('#releaseForumResult').html(data.msg);$('#myModalLabel').html("请求已发送");$('#title').val('');if(data.code===3){$('#gotoforum').html("去登陆");$('#gotoforum').attr("href","../html/login.html")}if(data.code===1){$('#gotoforum').html("查看");$('#editor-one').html('');$('#gotoforum').attr("href","../p/"+data.data)}}})}};function getUserInfo(){var token=localStorage.getItem("Authorization");if(null!=token){$.ajax({type:'post',url:'../base/userInfo',headers:{Authorization:token},success:function(resp){if(resp.code!=1){localStorage.clear()}else{var uid=resp.userid;var uname=resp.username;$('#loga').html("退出");$('#loga').attr("onclick","logOut()");$('#loga').attr("data-target","");$('#loga').attr("class","btn btn-danger btn-lg ");$('#myhome').attr("href","../user/myHome?uid="+uid+"&uname="+uname+"&info="+token);$('#editme').attr("href","../user/toEditMe?uid="+uid+"&uname="+uname+"&info="+token);$('#myfriends').attr("href","../user/myFriend?info="+token)}}})}};function loginthis(){var uname=$('#username').val();var passwd=$('#password').val();$.ajax({type:'post',url:'../base/login',data:{"username":uname,"password":passwd},dataType:'json',success:function(resp){if(resp.code!=1){$('#loginfailedinfo').html(resp.msg);$('#password').val("")}else{localStorage.setItem("Authorization",resp.data);window.location.reload()}}})};function weifuzhidaole(){$('#releaseForumInfo').modal("hide")};function submitlogin(){var uname=$('#busername').val().trim();var passwd=$('#bpassword').val();if(null==uname||null==passwd){}else{$.ajax({type:'post',url:'../base/login',dataType:'json',data:{"username":uname,"password":passwd},success:function(resp){if(resp.code!=1){$('#bloginfailedinfo').html(resp.msg);$('#bpassword').val("")}else{localStorage.setItem("Authorization",resp.data);window.location.reload()}}})}};function logOut(){localStorage.removeItem("Authorization");$.ajax({type:"post",url:"../logout",success:function(){window.location.href="../logout"}})};