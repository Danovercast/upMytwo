$(function(){$("#datetimepicker1").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")});$("#datetimepicker2").datetimepicker({format:"YYYY-MM-DD hh:mm",locale:moment.locale("zh-cn")});findInstitution();addInfo()});function showMenu(){document.getElementById("dropMenu").style.display="block"}function hideMenu(){document.getElementById("dropMenu").style.display="none"}var token=localStorage.getItem("Authorization");$("#imagea").fileinput({language:"zh",uploadUrl:"../user/editImg?info="+token,allowedFileExtensions:["jpg","png"],showUpload:true,showRemove:true,minImageHeight:200,minImageWidth:400,maxFileSize:150,maxFileCount:1,minFileCount:0,enctype:"multipart/form-data"}).on("fileuploaded",function(event,outData){$("#uploadinfo").modal("show");$("#uploadresult").html(outData.response.msg)});function findInstitution(){var currentpage=1;var pagesize=20;var pageinfo=JSON.stringify({"currentpage":currentpage,"pagesize":pagesize});$.ajax({type:"post",url:"../base/institutionList",dataType:"json",contentType:"application/json;charset=utf-8",data:pageinfo,success:function(data){for(var i=0;i<data.length;i++){$("#institution").append("<option class='text-center text-info' value='"+data[i].institution_id+"'>"+data[i].institution_name+"</option>")}}})}function changeMe(){var token=localStorage.getItem("Authorization");if(null!=token){var uid=$("#uid").val();var uname=$("#username").val();var email=$("#email").val();var insid=$("#institution").val();var passwd=$("#password").val();var telephone=$("#telephone").val();var birthday=$("#birthday").val();var signature=$("#signature").val().trim();var gender=$("input[name='gender']:checked").val();var dat=JSON.stringify({"user_id":uid,"username":uname,"email":email,"institution_id":insid,"password":passwd,"telephone":telephone,"birthday":birthday,"signature":signature,"gender":gender});$.ajax({type:"post",url:"../jwt/editUser",headers:{Authorization:token},dataType:"json",contentType:"application/json;charset=utf-8",data:dat,success:function(resp){$("#uploadinfo").modal("show");if(resp.code!=1){$("#uploadresult").html("除了点小问题,用户名不能重复."+resp.msg)}else{$("#uploadresult").html(resp.msg)}}})}else{}}function addInfo(){var uname=$("#username").val();var uid=$("#uid").val();var info=localStorage.getItem("Authorization");$("a[name='toEdit']").attr("href","../user/toEditMe?uname="+uname+"&uid="+uid+"&info="+info);$("a[name='mycomment']").attr("href","../user/myComment?uid="+uid+"&uname="+uname+"&info="+info);$("#myforuma").attr("href","../user/myHome?uid="+uid+"&uname="+uname+"&info="+info)}function logOut(){localStorage.removeItem("Authorization");$.ajax({type:"post",url:"../logout",success:function(){window.location.href="../"}})};