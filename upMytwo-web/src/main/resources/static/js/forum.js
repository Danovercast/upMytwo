$(function(){getCommentList(1,6);forumPageInfo(1,6);checkForumIsCollect();getInstitutionList(1,8);getMyInfo();var token=getLocalToken();loadpage();});function loginthis(){var username=$("#username").val();var password=$("#password").val();$.ajax({type:"post",url:"../base/login",dataType:"json",data:{username:username,password:password},success:function(resp){if(resp.code===1){localStorage.clear();localStorage.setItem("Authorization",resp.data);window.location.reload();}}});}function getCommentList(currentpage,pagesize){var forumid=$("#forumid").val();var dat=JSON.stringify({forumid:forumid,currentpage:currentpage,pagesize:pagesize});$.ajax({type:"post",url:"../comment/forumComment",contentType:"application/json;charset=utf-8",dataType:"json",data:dat,success:function(data){for(var i=0;i<data.length;i++){var step=i+1;$("#forumContent").append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'> <div class='row'style='margin: 1cm;'> <div class='col-md-3 comment_left'> <img title src='../images/"+data[i].image+"' class='img-thumbnail   popover-options' data-container='body' data-placement='left'  data-toggle='popover'   data-content=\"<div class='col-md-12 col-xs-12 text-center'style='border: 1px solid #5bc0de;border-radius:28px;text-align: center'><div class='x_panel fixed_height_390'><div class='x_content'><div class='flex'><ul class='list-inline widget_profile_box'><li><a href='#'><img src='picture/lunbo2.jpg' class='img-circle profile_img'style='width:150px;height:150px;'></a></li></ul></div><hr><h3 class='name'>Musimbi</h3><div class='flex'><ul class='list-inline count2'><li><h3>123</h3><span>Articles</span></li><li><h3>1234</h3><span>Followers</span></li><li><h3>123</h3><span>Following</span></li></ul></div><hr><p>If you ve.</p></div></div></div>\"  style='width: 160px; height: 120px; max-width: 90%; max-height: 80%'>    <div class='nameDiv'><b>"+data[i].responsername+"</b></div></div> <div class='col-md-9'><div style='float: right'><p>#"+step+"</p></div><hr><blockquote><p>"+data[i].details+"</p> <a style='float: right'><small>回复:</small></a><p style='float: right'><small>时间:"+data[i].createtime+"</small></p></blockquote></div></div></div>");}}});}function releaseComment(){var token=getLocalToken();if(token===null){$("#releaseCommentInfo").modal("show");$("#releaseCommentResult").html("未登录,或者验证信息过期请登陆");$("#refresh").html("登陆");$("#refresh").attr("href","../html/login.html");console.log("no user login");}else{var details=$("#editor-one").html();var forumid=$("#forumid").val();dat=JSON.stringify({details:details,forum_id:forumid});$.ajax({type:"post",url:"../jwt/releaseComment",dataType:"json",data:dat,contentType:"application/json;charset=utf-8",headers:{Authorization:token},success:function(data){if(data.code!=1){$("#releaseCommentInfo").modal("show");$("#releaseCommentResult").html(data.msg);$("#refresh").html("重新登陆");$("#refresh").attr("href","../html/login.html");}else{window.location.reload();}}});}}function forumPageInfo(currentpage,pagesize){if(currentpage<1||pagesize<1){var currentpage=1;var pagesize=8;}var forumid=$("#forumid").val();var dat=JSON.stringify({currentpage:currentpage,pagesize:pagesize,forumid:forumid});$.ajax({type:"post",url:"../comment/forumCommentPageInfo",data:dat,dataType:"json",contentType:"application/json;charset=utf-8",success:function(pageinfo){for(var i=1;i<=pageinfo.totalpage;i++){if(i===1){$("#pageul").append(" <li><a href='javascript:void(0)' onclick='changepage("+pageinfo.currentpage+")'>Previous</a></li>");}$("#pageul").append(" <li class='active'><a href='javascript:void(0)' onclick='changepage("+i+")'>"+i+"</a></li>");if(i===pageinfo.totalpage){$("#pageul").append(" <li class='active'><a href='javascript:void(0)' onclick='changepage("+i+")'>Next</a></li>");}}$('#golast').attr("onclick","changepage("+pageinfo.totalpage+")")}});}function changepage(page){if(page<1){}else{var forumid=$("#forumid").val();var pagesize=6;var dat=JSON.stringify({forumid:forumid,pagesize:pagesize,currentpage:page});$.ajax({type:"post",url:"../comment/forumComment",data:dat,contentType:"application/json;charset=utf-8",dataType:"json",success:function(data){$("#forumContent").empty();for(var i=0;i<data.length;i++){$("#forumContent").append("<div class='blog-post'style='border: 2px solid #d5dbe2; border-radius: 3px'> <div class='row'style='margin: 1cm;'> <div class='col-md-3 comment_left'> <img  src='../images/"+data[i].image+"' class='img-thumbnail   popover-options' data-container='body' data-placement='left'  data-toggle='popover'   data-content=\"<div class='col-md-12 col-xs-12 text-center'style='border: 1px solid #5bc0de;border-radius:28px;text-align: center'><div class='x_panel fixed_height_390'><div class='x_content'><div class='flex'><ul class='list-inline widget_profile_box'><li><a href='#'><img src='picture/lunbo2.jpg' class='img-circle profile_img'style='width:150px;height:150px;'></a></li></ul></div><hr><h3 class='name'>Musimbi</h3><div class='flex'><ul class='list-inline count2'><li><h3>123</h3><span>Articles</span></li><li><h3>1234</h3><span>Followers</span></li><li><h3>123</h3><span>Following</span></li></ul></div><hr><p>If you ve.</p></div></div></div>\"  style='width: 160px; height: 120px; max-width: 90%; max-height: 80%'>    <div class='nameDiv'><b>"+data[i].responsername+"</b></div></div> <div class='col-md-9'><div style='float: right'><p>#"+i+"</p></div><hr><blockquote><p>"+data[i].details+"</p> <a style='float: right'><small>回复:</small></a><p style='float: right'><small>时间:"+data[i].createtime+"</small></p></blockquote></div></div></div>");}}});}}function collectthis(){var info=localStorage.getItem("Authorization");if(null==info){$("#failedInfo").show();$("#failedmsg").html("您的验证信息可能过期,请重新登陆重试");}else{var forumid=$("#forumid").val();var dat=JSON.stringify({forum_id:forumid,is_collect:true});$.ajax({type:"post",url:"../jwt/myCollectForum",data:dat,contentType:"application/json;charset=utf-8",dataType:"json",headers:{Authorization:localStorage.getItem("Authorization")},success:function(resp){if(null===resp||resp.code!=1){$("#failedInfo").show();$("#failedmsg").html(resp.msg);}else{$("#collectButton").attr("class","btn btn-info btn-sm aBtn");$("#collectButton").html("已收藏");$("#collectButton").val(1);$("#collectButton").attr("onclick","editCollect(this)");$("#successInfo").show();$("#successmsg").html(resp.msg);}}});}}function checkForumIsCollect(){var token=localStorage.getItem("Authorization");if(token!=null){var forumid=$("#forumid").val();$.ajax({type:"post",url:"../jwt/checkForumCollect",data:{forum_id:forumid},dataType:"json",headers:{Authorization:token},success:function(data){if(data.code===1){$("#collectButton").attr("class","btn btn-info btn-sm aBtn");$("#collectButton").html("已收藏");$("#collectButton").val(1);$("#collectButton").attr("onclick","editCollect(this)");}else if(data.code===2){$("#collectButton").attr("class","btn btn-default btn-sm aBtn");$("#collectButton").html("收藏");$("#collectButton").val(0);$("#collectButton").attr("onclick","editCollect(this)");}else{$("#collectButton").attr("class","btn btn-default btn-sm aBtn");$("#collectButton").html("收藏");$("#collectButton").val(0);$("#collectButton").attr("onclick","collectthis()");}}});}}function editCollect(obj){var btnvalue=$("#collectButton").val();if(btnvalue==1){var collect=false;}else{var collect=true;}var token=getLocalToken();if(token!=null){var forumid=$("#forumid").val();var dat=JSON.stringify({forum_id:forumid,is_collect:collect});$.ajax({type:"post",url:"../jwt/editmyCollectForum",headers:{Authorization:token},contentType:"application/json;charset=utf-8",dataType:"json",data:dat,success:function(data){if(data.code!=1){localStorage.clear();$("#failedInfo").show();$("#failedmsg").html(data.msg);}else{if(btnvalue==1){$("#collectButton").attr("class","btn btn-default btn-sm aBtn");$("#collectButton").html("收藏");$("#collectButton").val(0);$("#collectButton").attr("onclick","editCollect(this)");}else{$("#collectButton").attr("class","btn btn-info btn-sm aBtn");$("#collectButton").html("已收藏");$("#collectButton").val(1);$("#collectButton").attr("onclick","editCollect(this)");}$("#successInfo").show();$("#successmsg").html(data.msg);}}});}}function getInstitutionList(currentpage,pagesize){console.log("hi");var dat=JSON.stringify({currentpage:currentpage,pagesize:pagesize});$.ajax({type:"post",url:"../base/institutionList",dataType:"json",contentType:"application/json;charset=utf-8",data:dat,success:function(data){for(var i=0;i<data.length;i++){$("#institutionDiv").append("<div><a class='alert-info btn' href='../ins/"+data[i].institution_id+"' target='_blank'>"+data[i].institution_name+"</a></div>");}}});}function getLocalToken(){return localStorage.getItem("Authorization");}function getMyInfo(){var token=getLocalToken();if(null!=token){$.ajax({type:"post",url:"../base/userInfo",dataType:"json",headers:{Authorization:token},success:function(resp){var uid=resp.userid;var uname=resp.username;var authorid=$("#authorid").val();$("#myhome").attr("href","../user/myHome?uid="+uid+"&uname="+uname+"&info="+token);$("#authora").attr("href","../user/otherUser?uid="+authorid+"&info="+token);$("#authora2").attr("href","../user/otherUser?uid="+authorid+"&info="+token);$("#mysigna").html(resp.signature);}});}}function loadpage(){var token=getLocalToken();if(null!=token){$("#bottomlogin").hide();}}